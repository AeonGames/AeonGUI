name: Build on macOS

on: [push, pull_request]

env:
  BUILD_TYPE: Release

jobs:
  build:
    runs-on: macos-latest

    strategy:
      matrix:
        compiler: [clang]

    steps:
    - name: '🧰 Checkout'
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: '📦 Install dependencies'
      run: |
        brew update
        brew install cmake pkg-config cairo pango libxml2 googletest gsed bison
      if: matrix.compiler == 'clang'

    - name: '🛠️ Configuring'
      run: |
        export PATH="/opt/homebrew/opt/bison/bin:$PATH"
        export PKG_CONFIG_PATH="/opt/homebrew/lib/pkgconfig:$PKG_CONFIG_PATH"
        cmake -B ${{github.workspace}}/build -DCMAKE_BUILD_TYPE=${{env.BUILD_TYPE}}
      if: matrix.compiler == 'clang'

    - name: '🏗️ Building'
      run: cmake --build ${{github.workspace}}/build

    - name: '🧪 Running Tests'
      run: ctest --test-dir ${{github.workspace}}/build